<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Fasset: C:/main/trunk/src/products/manure.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Fasset</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">C:/main/trunk/src/products/manure.cpp</div>  </div>
</div>
<div class="contents">
<a href="manure_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************\</span>
<a name="l00002"></a>00002 <span class="comment"> $URL$</span>
<a name="l00003"></a>00003 <span class="comment"> $LastChangedDate$</span>
<a name="l00004"></a>00004 <span class="comment"> $LastChangedRevision$</span>
<a name="l00005"></a>00005 <span class="comment"> $LastChangedBy$</span>
<a name="l00006"></a>00006 <span class="comment">\****************************************************************************/</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &quot;../base/common.h&quot;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &quot;<a class="code" href="manure_8h.html">manure.h</a>&quot;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &quot;../base/climate.h&quot;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#ifdef _STANDALONE</span>
<a name="l00011"></a>00011 <span class="preprocessor"></span><span class="preprocessor">        #include &quot;../base/message.h&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#endif</span>
<a name="l00013"></a>00013 <span class="preprocessor"></span>
<a name="l00014"></a>00014 <span class="comment">//double degrate = 0.00001;</span>
<a name="l00015"></a>00015 <span class="comment">/****************************************************************************\</span>
<a name="l00016"></a>00016 <span class="comment">  Constructor</span>
<a name="l00017"></a>00017 <span class="comment">\****************************************************************************/</span>
<a name="l00018"></a><a class="code" href="classmanure.html#a169ecc5b27034bb777db79053f571c6e">00018</a> <a class="code" href="classmanure.html#a169ecc5b27034bb777db79053f571c6e">manure::manure</a>()
<a name="l00019"></a>00019    : <a class="code" href="classdecomposable.html">decomposable</a>()
<a name="l00020"></a>00020 {
<a name="l00021"></a>00021    <a class="code" href="classmanure.html#ac45a5d29b499ebe4f93a8473dc2cf821">InitVariables</a>();
<a name="l00022"></a>00022 }
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="comment">/****************************************************************************\</span>
<a name="l00025"></a>00025 <span class="comment">  Constructor with arguments</span>
<a name="l00026"></a>00026 <span class="comment">\****************************************************************************/</span>
<a name="l00027"></a><a class="code" href="classmanure.html#a38f96dbe471887e6846f2435209bce64">00027</a> <a class="code" href="classmanure.html#a169ecc5b27034bb777db79053f571c6e">manure::manure</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * aName, <span class="keyword">const</span> <span class="keywordtype">int</span> aIndex, <span class="keyword">const</span> <a class="code" href="classbase.html">base</a> * aOwner)
<a name="l00028"></a>00028    : <a class="code" href="classdecomposable.html">decomposable</a>(aName, aIndex, aOwner)
<a name="l00029"></a>00029 {
<a name="l00030"></a>00030    <a class="code" href="classmanure.html#ac45a5d29b499ebe4f93a8473dc2cf821">InitVariables</a>();
<a name="l00031"></a>00031 }
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="comment">/****************************************************************************\</span>
<a name="l00034"></a>00034 <span class="comment">  Copy Constructor</span>
<a name="l00035"></a>00035 <span class="comment">\****************************************************************************/</span>
<a name="l00036"></a><a class="code" href="classmanure.html#afbb8c5beb0e7ac02c565f8d754a05558">00036</a> <a class="code" href="classmanure.html#a169ecc5b27034bb777db79053f571c6e">manure::manure</a>(<span class="keyword">const</span> <a class="code" href="classmanure.html">manure</a>&amp; amanure)
<a name="l00037"></a>00037    : <a class="code" href="classdecomposable.html">decomposable</a>(amanure)
<a name="l00038"></a>00038 {
<a name="l00039"></a>00039    Mg_content   = amanure.Mg_content;
<a name="l00040"></a>00040    Cu_content   = amanure.Cu_content;
<a name="l00041"></a>00041    Rt_content   = amanure.Rt_content;
<a name="l00042"></a>00042    <a class="code" href="classlive_matter.html#a1a622bc1c2258ae716f26c9dd3bf66d1">dryMatter</a>    = amanure.<a class="code" href="classlive_matter.html#a1a622bc1c2258ae716f26c9dd3bf66d1">dryMatter</a>;
<a name="l00043"></a>00043    sand                     = amanure.sand;
<a name="l00044"></a>00044 
<a name="l00045"></a>00045    pH               = amanure.pH;
<a name="l00046"></a>00046    infiltFactor = amanure.infiltFactor;
<a name="l00047"></a>00047    canopyStorageParameter = amanure.canopyStorageParameter;
<a name="l00048"></a>00048    maxDeg = amanure.maxDeg;
<a name="l00049"></a>00049    degRateConst  = amanure.degRateConst;
<a name="l00050"></a>00050    degradableOM  = amanure.degradableOM;
<a name="l00051"></a>00051 }
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="comment">/****************************************************************************\</span>
<a name="l00054"></a>00054 <span class="comment">  Copy Constructor - with decomposable (used when adding bedding)</span>
<a name="l00055"></a>00055 <span class="comment">\****************************************************************************/</span>
<a name="l00056"></a><a class="code" href="classmanure.html#a46c220944c99cbd781019f206233bf32">00056</a> <a class="code" href="classmanure.html#a169ecc5b27034bb777db79053f571c6e">manure::manure</a>(<span class="keyword">const</span> <a class="code" href="classdecomposable.html">decomposable</a>&amp; aDecomp)
<a name="l00057"></a>00057    : <a class="code" href="classdecomposable.html">decomposable</a>(aDecomp)
<a name="l00058"></a>00058 {
<a name="l00059"></a>00059    <a class="code" href="classproduct.html#a885b4a4a79f193386ef9648b99839978">SetObjType</a>(<a class="code" href="typer_8h.html#a3e272b4d234d0ce067866b1b95610047a4591e4582b7aa867439ea50bfaa34c36">manureObj</a>); <span class="comment">//make sure right object type (could have been changed if there is more than one floor</span>
<a name="l00060"></a>00060    Mg_content   = 0.0;
<a name="l00061"></a>00061    Cu_content   = 0.0;
<a name="l00062"></a>00062    Rt_content   = 0.0;
<a name="l00063"></a>00063    sand                     = 0.0;
<a name="l00064"></a>00064    pH               = 7.0;
<a name="l00065"></a>00065 
<a name="l00066"></a>00066    infiltFactor = 0.0;
<a name="l00067"></a>00067    canopyStorageParameter=0.0;
<a name="l00068"></a>00068    maxDeg = 0.20;
<a name="l00069"></a>00069    degRateConst = 0.0;      <span class="comment">//njh - may 2009 - was commented out but lack of initialiation caused memory error</span>
<a name="l00070"></a>00070    degradableOM = maxDeg * <a class="code" href="classmanure.html#ad293bc0666ccc034fe1f15a1df2a4010">GetOrgMatterConc</a>();
<a name="l00071"></a>00071 }
<a name="l00072"></a>00072 <span class="comment">/****************************************************************************\</span>
<a name="l00073"></a>00073 <span class="comment"> Destructor</span>
<a name="l00074"></a>00074 <span class="comment">\****************************************************************************/</span>
<a name="l00075"></a><a class="code" href="classmanure.html#ac1beb68437856daf80d130aa4714cf66">00075</a> <a class="code" href="classmanure.html#ac1beb68437856daf80d130aa4714cf66">manure::~manure</a>()
<a name="l00076"></a>00076 {
<a name="l00077"></a>00077 }
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="comment">/****************************************************************************\</span>
<a name="l00080"></a>00080 <span class="comment">\****************************************************************************/</span>
<a name="l00081"></a><a class="code" href="classmanure.html#ac45a5d29b499ebe4f93a8473dc2cf821">00081</a> <span class="keywordtype">void</span> <a class="code" href="classmanure.html#ac45a5d29b499ebe4f93a8473dc2cf821">manure::InitVariables</a>()
<a name="l00082"></a>00082 {
<a name="l00083"></a>00083         <a class="code" href="classmanure.html#ac45a5d29b499ebe4f93a8473dc2cf821">decomposable::InitVariables</a>();
<a name="l00084"></a>00084    Mg_content   = 0.0;
<a name="l00085"></a>00085    Cu_content   = 0.0;
<a name="l00086"></a>00086    Rt_content   = 0.0;
<a name="l00087"></a>00087    sand                     = 0;
<a name="l00088"></a>00088 
<a name="l00089"></a>00089    pH               = 7.0;
<a name="l00090"></a>00090    infiltFactor = 0.0;
<a name="l00091"></a>00091    canopyStorageParameter=0.0;
<a name="l00092"></a>00092    <a class="code" href="classproduct.html#ae0b4ae3c238d363f60f145b7dc40804c">ObjType</a>        = <a class="code" href="typer_8h.html#a3e272b4d234d0ce067866b1b95610047a4591e4582b7aa867439ea50bfaa34c36">manureObj</a>;
<a name="l00093"></a>00093    maxDeg = 0.2;
<a name="l00094"></a>00094    degRateConst = 0.0;      <span class="comment">//njh - may 2009 - was commented out but lack of initialiation caused memory error</span>
<a name="l00095"></a>00095    degradableOM = maxDeg * <a class="code" href="classmanure.html#ad293bc0666ccc034fe1f15a1df2a4010">GetOrgMatterConc</a>();
<a name="l00096"></a>00096 }
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 <span class="comment">/****************************************************************************\</span>
<a name="l00099"></a>00099 <span class="comment">  GetQ(temp) returns the equilibrium constant Q described in</span>
<a name="l00100"></a>00100 <span class="comment">  [Hutchings et. al 95] pp590. given the temperature of the manure</span>
<a name="l00101"></a>00101 <span class="comment">\****************************************************************************/</span>
<a name="l00102"></a><a class="code" href="classmanure.html#a7b77b90caee4bc5fcf2dea610ffdd321">00102</a> <span class="keywordtype">double</span> <a class="code" href="classmanure.html#a7b77b90caee4bc5fcf2dea610ffdd321">manure::GetQ</a>(<span class="keywordtype">double</span> temp)<span class="keyword"> const</span>
<a name="l00103"></a>00103 <span class="keyword"></span>{
<a name="l00104"></a>00104         <span class="keywordtype">double</span> Khx,Knh4x,PHx,Q;
<a name="l00105"></a>00105    PHx=<a class="code" href="classmanure.html#aeb6b9f64e829c8f799cd771c6090cdcf">GetpH</a>();
<a name="l00106"></a>00106         Khx=pow(10,(-1.69+(1477.7/(temp+273))));
<a name="l00107"></a>00107    Knh4x=1+pow(10,(0.09018+(2729.92/(temp+273))-PHx));
<a name="l00108"></a>00108    Q=Khx*Knh4x;
<a name="l00109"></a>00109    <span class="keywordflow">return</span> Q;
<a name="l00110"></a>00110 }
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 <span class="comment">/*</span>
<a name="l00113"></a>00113 <span class="comment"> * Remove water from Manure. Does also update, Mg_content, Cu_content, Rt_content, sand and degradableOM</span>
<a name="l00114"></a>00114 <span class="comment"> */</span>
<a name="l00115"></a><a class="code" href="classmanure.html#a1bfcf202c765d99c51fb8ed6850e21a2">00115</a> <span class="keywordtype">double</span> <a class="code" href="classmanure.html#a1bfcf202c765d99c51fb8ed6850e21a2">manure::SubtractWater</a>(<span class="keywordtype">double</span> waterToSubtract)
<a name="l00116"></a>00116 {
<a name="l00117"></a>00117  <span class="keywordtype">double</span> <a class="code" href="classwater.html" title="water class in fasset">water</a> = <a class="code" href="classproduct.html#a021ebef2da57e1d977cfe57e62c6e38b">GetAmount</a>()*(1-<a class="code" href="classlive_matter.html#ad3d05f1e8ceedc99e214adca94638de0">GetdryMatter</a>());
<a name="l00118"></a>00118  <span class="keywordflow">if</span> (waterToSubtract!=0.0)
<a name="l00119"></a>00119  {
<a name="l00120"></a>00120     <span class="keywordtype">double</span> DM = <a class="code" href="classproduct.html#a021ebef2da57e1d977cfe57e62c6e38b">GetAmount</a>()*<a class="code" href="classlive_matter.html#ad3d05f1e8ceedc99e214adca94638de0">GetdryMatter</a>();
<a name="l00121"></a>00121     <span class="keywordflow">if</span> (fabs(water-waterToSubtract)&lt;0.00000001)
<a name="l00122"></a>00122         waterToSubtract=water;   <span class="comment">//to avoid false error caused by precision in double</span>
<a name="l00123"></a>00123     <span class="keywordflow">if</span> ((water-waterToSubtract)&lt;0)
<a name="l00124"></a>00124       waterToSubtract=water;
<a name="l00125"></a>00125    water-=waterToSubtract;
<a name="l00126"></a>00126    <span class="keywordflow">if</span> (DM!=0.0)   <span class="comment">//is not clean water</span>
<a name="l00127"></a>00127    {
<a name="l00128"></a>00128       Mg_content   = <a class="code" href="classmanure.html#a33d61ff2bca9b2344ca013d284176395">GetMg_content</a>() * <a class="code" href="classproduct.html#a021ebef2da57e1d977cfe57e62c6e38b">GetAmount</a>()/(water+DM);
<a name="l00129"></a>00129       Cu_content   = <a class="code" href="classmanure.html#af7b3d4f63546db980e899016faeeb500">GetCu_content</a>() * <a class="code" href="classproduct.html#a021ebef2da57e1d977cfe57e62c6e38b">GetAmount</a>()/(water+DM);
<a name="l00130"></a>00130       Rt_content   = <a class="code" href="classmanure.html#af02a1de2138e4c9e2aa182a2891e5182">GetRt_content</a>() * <a class="code" href="classproduct.html#a021ebef2da57e1d977cfe57e62c6e38b">GetAmount</a>()/(water+DM);
<a name="l00131"></a>00131       sand               = <a class="code" href="classmanure.html#aae99257f7fb59e92b218339362b9cb4b">Getsand</a>() * <a class="code" href="classproduct.html#a021ebef2da57e1d977cfe57e62c6e38b">GetAmount</a>()/(water+DM);
<a name="l00132"></a>00132       degradableOM  = <a class="code" href="classmanure.html#ade6dc43e945016f901ced6a54527ea80">GetdegradableOM</a>() * <a class="code" href="classproduct.html#a021ebef2da57e1d977cfe57e62c6e38b">GetAmount</a>()/(water+DM);
<a name="l00133"></a>00133       <a class="code" href="classmanure.html#a1bfcf202c765d99c51fb8ed6850e21a2">liveMatter::SubtractWater</a>(waterToSubtract);
<a name="l00134"></a>00134    }
<a name="l00135"></a>00135    <span class="keywordflow">else</span>
<a name="l00136"></a>00136       <a class="code" href="classproduct.html#a18ec2e96f1d9b7cef74c4b2800ebdca1">Setamount</a>(water);
<a name="l00137"></a>00137  }
<a name="l00138"></a>00138  <span class="keywordflow">return</span> waterToSubtract;
<a name="l00139"></a>00139 }
<a name="l00140"></a>00140 
<a name="l00141"></a>00141 
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 <span class="comment">/****************************************************************************\</span>
<a name="l00144"></a>00144 <span class="comment">\****************************************************************************/</span>
<a name="l00145"></a><a class="code" href="classmanure.html#ad759c54bfd7b7656f5601b39efee16a4">00145</a> <span class="keywordtype">double</span> <a class="code" href="classmanure.html#ad759c54bfd7b7656f5601b39efee16a4">manure::VolatAmmonia</a>(<span class="keywordtype">double</span> temperature, <span class="keywordtype">double</span> evap, <span class="keywordtype">double</span> infiltration, <span class="keywordtype">double</span> precipitation,
<a name="l00146"></a>00146                 <span class="keywordtype">double</span> area, <span class="keywordtype">double</span> resistance, <span class="keywordtype">double</span> duration, <span class="keywordtype">double</span> *volEvap, <a class="code" href="classmanure.html">manure</a> *toSoil)
<a name="l00147"></a>00147 {  <span class="comment">//returns volatilisation in tonnes</span>
<a name="l00148"></a>00148         <span class="comment">//temperature in K, infilt, precip and evap in (kg per sq metre per hr (mm/hr), area in sq metres and resistance in s per metre</span>
<a name="l00149"></a>00149    <span class="keywordtype">double</span> volat=0;
<a name="l00150"></a>00150 <span class="comment">/*</span>
<a name="l00151"></a>00151 <span class="comment">  Instantaneous flux (g/sq m/s) = (1/resistance) * Kh * 14 * [TAN]/(R*(temperature+273) * (1+pow(10,-pH)/KN))</span>
<a name="l00152"></a>00152 <span class="comment">  [TAN] =  NH4_content *amount * 1000/(14* amount *(1-dryMatter))   kg mol per litre</span>
<a name="l00153"></a>00153 <span class="comment">  assumes 1 litre=1 kg, molecular wt of N (14) cancels out</span>
<a name="l00154"></a>00154 <span class="comment">  Note - operates on hourly not per second basis; resistance input still in per second basis</span>
<a name="l00155"></a>00155 <span class="comment">*/</span>
<a name="l00156"></a>00156    <span class="keywordflow">if</span> (!(toSoil)&amp;&amp; (infiltration &gt;0.0))
<a name="l00157"></a>00157          <a class="code" href="message_8h.html#a8ad29009121a629982c6ade0bd332470">theMessage</a>-&gt;<a class="code" href="classmessage.html#af9891cb7111375e6a36363afffb09d63">FatalError</a>(<span class="stringliteral">&quot;manure:: Infiltration of manure &gt;0 without receiptor object defined&quot;</span>);
<a name="l00158"></a>00158    <span class="keywordflow">if</span> (toSoil)
<a name="l00159"></a>00159    {
<a name="l00160"></a>00160                 toSoil-&gt;<a class="code" href="classproduct.html#a18ec2e96f1d9b7cef74c4b2800ebdca1">Setamount</a>(0.0);
<a name="l00161"></a>00161       toSoil-&gt;<a class="code" href="classlive_matter.html#aee8cb3a1d73625321b1b73dd285dffb4">SetDryMatter</a>(0.0);
<a name="l00162"></a>00162       toSoil-&gt;<a class="code" href="classlive_matter.html#adbb45be219dd863cfad2b5e97cde1508">SetorgN_content</a>(0.0);   <span class="comment">//DM and organic N is retained on surface</span>
<a name="l00163"></a>00163    }
<a name="l00164"></a>00164 
<a name="l00165"></a>00165         <span class="keywordflow">if</span> (<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>&gt;0.0)
<a name="l00166"></a>00166    {
<a name="l00167"></a>00167         <span class="keywordflow">if</span> ((pH&lt;1.0)||(pH&gt;12.0))
<a name="l00168"></a>00168       <a class="code" href="message_8h.html#a8ad29009121a629982c6ade0bd332470">theMessage</a>-&gt;<a class="code" href="classmessage.html#af9891cb7111375e6a36363afffb09d63">FatalError</a>(<span class="stringliteral">&quot;pmanure: volatilisation error in pH values&quot;</span>);
<a name="l00169"></a>00169            <span class="keywordtype">double</span> loss=0.0;
<a name="l00170"></a>00170       <span class="keywordtype">double</span> TANtoSoil = 0.0;
<a name="l00171"></a>00171       <span class="keywordtype">double</span> totalNInput = <a class="code" href="classlive_matter.html#ac2063bf6ed8da618b7b2b2b47defaa12">GetAllN</a>().<a class="code" href="classnitrogen.html#aa708078375ba23f1dd31e08e28269dac">n</a> * <a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>;
<a name="l00172"></a>00172       <span class="keywordtype">double</span> volInfiltration = infiltration * duration/1000.0;  <span class="comment">//convert from mm to tonnes per sq metre</span>
<a name="l00173"></a>00173       *volEvap= evap * duration/1000.0;  <span class="comment">//convert from mm to tonnes per sq metre</span>
<a name="l00174"></a>00174       <span class="keywordtype">double</span> startTAN = <a class="code" href="classlive_matter.html#a8e7a9da472ef95f8426cab359acae69f" title="fraction N in NH4 of total amount">NH4_content</a>.<a class="code" href="classnitrogen.html#aa708078375ba23f1dd31e08e28269dac">n</a>*<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a> * 1000000.0/area;   <span class="comment">//in grams per sq metre</span>
<a name="l00175"></a>00175         <span class="keywordtype">double</span> TANPresent = startTAN;
<a name="l00176"></a>00176 
<a name="l00177"></a>00177       <span class="keywordtype">double</span> volume = <a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a> * (1-<a class="code" href="classlive_matter.html#a1a622bc1c2258ae716f26c9dd3bf66d1">dryMatter</a>) * 1000.0/area;  <span class="comment">// litres/m**2  == mm</span>
<a name="l00178"></a>00178       <span class="keywordtype">double</span> KN=exp(-177.95292 - (1843.22/(temperature+273.15)) + 31.4335*log(temperature+273.15)
<a name="l00179"></a>00179                                 - 0.0544943*(temperature+273.15));  <span class="comment">//no units</span>
<a name="l00180"></a>00180       <span class="keywordtype">double</span> Kh=exp(160.559-(8621.06/(temperature+273.15))
<a name="l00181"></a>00181                                 - 25.6767*log(temperature+273.15)+0.035388*(temperature+273.15));  <span class="comment">// atm litre /mol</span>
<a name="l00182"></a>00182       <span class="keywordtype">double</span> R=0.0000820575;  <span class="comment">//universal gas constant in m**3 atm/(mol K)</span>
<a name="l00183"></a>00183       <span class="keywordtype">double</span> KH=14.0 * Kh/(R*(temperature+273.15));   <span class="comment">//g litre/(m**3 mol)</span>
<a name="l00184"></a>00184       <span class="keywordflow">if</span> (resistance==0)
<a name="l00185"></a>00185          <a class="code" href="message_8h.html#a8ad29009121a629982c6ade0bd332470">theMessage</a>-&gt;<a class="code" href="classmessage.html#af9891cb7111375e6a36363afffb09d63">FatalError</a>(<span class="stringliteral">&quot;manure:: The transfer resistance for ammonia loss cannot be zero&quot;</span>);
<a name="l00186"></a>00186       <span class="keywordtype">double</span> q = 3600.0 * KH/((1+pow(10,-pH)/KN)*resistance * volume * 14.0); <span class="comment">//rate constant, per hour</span>
<a name="l00187"></a>00187       <span class="keywordflow">if</span> (duration * (infiltration + evap - precipitation)&gt;=volume) <span class="comment">//dries completely</span>
<a name="l00188"></a>00188       {
<a name="l00189"></a>00189                  <span class="comment">//theMessage-&gt;FatalError(&quot;manure:: volatilisation - do not use this without checking if it works&quot;);</span>
<a name="l00190"></a>00190             volInfiltration = volume * (infiltration/(evap + infiltration))/1000.0;  <span class="comment">//convert from mm to tonnes per sq metre;</span>
<a name="l00191"></a>00191             *volEvap = volume * (evap/(evap + infiltration))/1000.0;  <span class="comment">//convert from mm to tonnes per sq metre;</span>
<a name="l00192"></a>00192             volat=TANPresent * (evap/(evap + infiltration));
<a name="l00193"></a>00193             TANtoSoil =TANPresent * (infiltration/(evap + infiltration));
<a name="l00194"></a>00194             loss = volat + TANtoSoil;
<a name="l00195"></a>00195       }
<a name="l00196"></a>00196       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((infiltration + evap - precipitation)==0) <span class="comment">//do not use function - get divide by zero error</span>
<a name="l00197"></a>00197          {
<a name="l00198"></a>00198             volat=TANPresent* (1-exp(-q*duration));           <span class="comment">// volume is constant - use exponential</span>
<a name="l00199"></a>00199             TANtoSoil=TANPresent * (1-exp(-infiltration*duration));           <span class="comment">// volume is constant - use exponential</span>
<a name="l00200"></a>00200             loss = volat + TANtoSoil;
<a name="l00201"></a>00201          }
<a name="l00202"></a>00202          <span class="keywordflow">else</span>
<a name="l00203"></a>00203          {
<a name="l00204"></a>00204 <span class="comment">//               theMessage-&gt;FatalError(&quot;manure:: volatilisation - do not use this without checking if it works&quot;);</span>
<a name="l00205"></a>00205             volat=TANPresent* (1-exp(-q*duration));           <span class="comment">// volume is constant - use exponential</span>
<a name="l00206"></a>00206             TANtoSoil=TANPresent * (1-exp(-infiltration*duration));           <span class="comment">// volume is constant - use exponential</span>
<a name="l00207"></a>00207             loss = volat + TANtoSoil;
<a name="l00208"></a>00208 <span class="comment">/*            double fact = evap - precipitation;</span>
<a name="l00209"></a>00209 <span class="comment">            double f1= 1-(infiltration+fact)*duration/volume;</span>
<a name="l00210"></a>00210 <span class="comment">            double f2= q/(infiltration+fact);</span>
<a name="l00211"></a>00211 <span class="comment">            double f3= infiltration/(infiltration+fact);</span>
<a name="l00212"></a>00212 <span class="comment">            double volatFunction = pow(f1,f2);</span>
<a name="l00213"></a>00213 <span class="comment">            double toSoilFunction = pow(f1,f3);</span>
<a name="l00214"></a>00214 <span class="comment">            loss = TANPresent * (1- volatFunction * toSoilFunction);</span>
<a name="l00215"></a>00215 <span class="comment">            TANtoSoil = loss * (1-toSoilFunction)/((1-toSoilFunction)+(1-volatFunction));</span>
<a name="l00216"></a>00216 <span class="comment">            volat = loss * (1-volatFunction)/((1-toSoilFunction)+(1-volatFunction));*/</span>
<a name="l00217"></a>00217          }
<a name="l00218"></a>00218     <span class="keywordflow">if</span> ((volat&lt;0)||(TANtoSoil&lt;0))
<a name="l00219"></a>00219          <a class="code" href="message_8h.html#a8ad29009121a629982c6ade0bd332470">theMessage</a>-&gt;<a class="code" href="classmessage.html#af9891cb7111375e6a36363afffb09d63">FatalError</a>(<span class="stringliteral">&quot;manure:: Volatilisation less than zero&quot;</span>);
<a name="l00220"></a>00220     <span class="keywordtype">double</span> newNH4_content;
<a name="l00221"></a>00221     volat *= area/1000000.0;       <span class="comment">//convert from grams per sq metre to tonnes</span>
<a name="l00222"></a>00222     loss *= area/1000000.0;
<a name="l00223"></a>00223     TANtoSoil *= area/1000000.0;
<a name="l00224"></a>00224     startTAN *= area/1000000.0;
<a name="l00225"></a>00225     volume *= area/1000000.0;
<a name="l00226"></a>00226     volInfiltration*=area;
<a name="l00227"></a>00227     *volEvap*=area;
<a name="l00228"></a>00228     <span class="keywordflow">if</span> (loss&gt;startTAN)
<a name="l00229"></a>00229     {
<a name="l00230"></a>00230                 volat = startTAN * volat/(volat + TANtoSoil);
<a name="l00231"></a>00231                 TANtoSoil = startTAN * TANtoSoil/(volat + TANtoSoil);
<a name="l00232"></a>00232         loss = volat +TANtoSoil;
<a name="l00233"></a>00233       newNH4_content = 0.0;
<a name="l00234"></a>00234     }
<a name="l00235"></a>00235     <span class="keywordflow">else</span>
<a name="l00236"></a>00236     {
<a name="l00237"></a>00237         <a class="code" href="classmanure.html#a1bfcf202c765d99c51fb8ed6850e21a2">SubtractWater</a>(volInfiltration + (*volEvap));
<a name="l00238"></a>00238       newNH4_content = (startTAN-loss)/<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>;
<a name="l00239"></a>00239     }
<a name="l00240"></a>00240     <span class="keywordtype">double</span> balance =  startTAN -(newNH4_content*<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a> +loss);
<a name="l00241"></a>00241     <span class="keywordflow">if</span> (fabs(balance)&gt;0.01)
<a name="l00242"></a>00242          <a class="code" href="message_8h.html#a8ad29009121a629982c6ade0bd332470">theMessage</a>-&gt;<a class="code" href="classmessage.html#af9891cb7111375e6a36363afffb09d63">FatalError</a>(<span class="stringliteral">&quot;manure:: Balance error in volatilisation&quot;</span>);
<a name="l00243"></a>00243 
<a name="l00244"></a>00244     <a class="code" href="classlive_matter.html#a8e7a9da472ef95f8426cab359acae69f" title="fraction N in NH4 of total amount">NH4_content</a> = newNH4_content;   <span class="comment">//sets new ammonium conc in pool</span>
<a name="l00245"></a>00245 
<a name="l00246"></a>00246          <span class="keywordtype">double</span> totalNToSoil = 0.0;
<a name="l00247"></a>00247     <span class="keywordflow">if</span> ((toSoil) &amp;&amp; (infiltration &gt;0.0))
<a name="l00248"></a>00248     {
<a name="l00249"></a>00249         toSoil-&gt;<a class="code" href="classproduct.html#a18ec2e96f1d9b7cef74c4b2800ebdca1">Setamount</a>(volInfiltration);
<a name="l00250"></a>00250         toSoil-&gt;<a class="code" href="classlive_matter.html#ae1c5d6b2f85882a85817e26a8fc9391f">SetNH4_content</a>(TANtoSoil/toSoil-&gt;<a class="code" href="classproduct.html#a021ebef2da57e1d977cfe57e62c6e38b">GetAmount</a>());     <span class="comment">//water budgeting may not be correct!</span>
<a name="l00251"></a>00251       totalNToSoil = toSoil-&gt;<a class="code" href="classlive_matter.html#ac2063bf6ed8da618b7b2b2b47defaa12">GetAllN</a>().<a class="code" href="classnitrogen.html#aa708078375ba23f1dd31e08e28269dac">n</a> * toSoil-&gt;<a class="code" href="classproduct.html#a021ebef2da57e1d977cfe57e62c6e38b">GetAmount</a>();
<a name="l00252"></a>00252     }
<a name="l00253"></a>00253     <span class="keywordtype">double</span> Nremaining = <a class="code" href="classlive_matter.html#ac2063bf6ed8da618b7b2b2b47defaa12">GetAllN</a>().<a class="code" href="classnitrogen.html#aa708078375ba23f1dd31e08e28269dac">n</a> * <a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>;
<a name="l00254"></a>00254     balance =  totalNInput - (Nremaining + volat  + totalNToSoil);
<a name="l00255"></a>00255     <span class="keywordflow">if</span> (fabs(balance)&gt;0.0001)
<a name="l00256"></a>00256          <a class="code" href="message_8h.html#a8ad29009121a629982c6ade0bd332470">theMessage</a>-&gt;<a class="code" href="classmessage.html#af9891cb7111375e6a36363afffb09d63">FatalError</a>(<span class="stringliteral">&quot;manure:: Balance error in volatilisation&quot;</span>);
<a name="l00257"></a>00257   }
<a name="l00258"></a>00258  <span class="keywordflow">return</span> volat;
<a name="l00259"></a>00259  <span class="comment">//volatilisation in tonnes.</span>
<a name="l00260"></a>00260 }
<a name="l00261"></a>00261 
<a name="l00265"></a><a class="code" href="classmanure.html#a6aba3f146ff412c234583f5f1c805000">00265</a> <span class="keywordtype">double</span> <a class="code" href="classmanure.html#a6aba3f146ff412c234583f5f1c805000">manure::GetWaterEvap</a>(<span class="keywordtype">double</span> temperature, <span class="keywordtype">double</span> relHumidity, <span class="keywordtype">double</span> area, <span class="keywordtype">double</span> resistance, <span class="keywordtype">double</span> duration)
<a name="l00266"></a>00266 {    <span class="comment">//returns evaporation in tonnes</span>
<a name="l00267"></a>00267         <span class="comment">//temperature in K, area in sq metres and resistance in s per metre</span>
<a name="l00268"></a>00268    <span class="keywordflow">if</span> (resistance &gt; 0.0)
<a name="l00269"></a>00269    {
<a name="l00270"></a>00270       <a class="code" href="classclimate.html">climate</a> * aClimate = <span class="keyword">new</span> <a class="code" href="classclimate.html">climate</a>();   <span class="comment">//to get access to some useful functions</span>
<a name="l00271"></a>00271       <span class="keywordtype">double</span> transferCoefficient = 1/resistance;
<a name="l00272"></a>00272       <span class="comment">// divide evaporation by 1000.0 to convert to tonnes</span>
<a name="l00273"></a>00273       <span class="keywordtype">double</span> result = (aClimate-&gt;<a class="code" href="classclimate.html#adf16cf971faa070a3a1f52cca3f25686">Evaporation</a>(temperature,relHumidity, transferCoefficient)/1000.0) *
<a name="l00274"></a>00274                                                          area * duration;
<a name="l00275"></a>00275       <span class="keywordtype">double</span> volume = <a class="code" href="classproduct.html#a021ebef2da57e1d977cfe57e62c6e38b">GetAmount</a>()*(1-<a class="code" href="classlive_matter.html#ad3d05f1e8ceedc99e214adca94638de0">GetdryMatter</a>());
<a name="l00276"></a>00276       <span class="keywordflow">if</span> (result&gt;volume)  <span class="comment">//all water evaporates</span>
<a name="l00277"></a>00277       {
<a name="l00278"></a>00278        duration =volume/result;
<a name="l00279"></a>00279        result=volume;
<a name="l00280"></a>00280       }
<a name="l00281"></a>00281       <span class="keyword">delete</span> aClimate;
<a name="l00282"></a>00282    }
<a name="l00283"></a>00283         <span class="keywordflow">else</span>
<a name="l00284"></a>00284         <a class="code" href="message_8h.html#a8ad29009121a629982c6ade0bd332470">theMessage</a>-&gt;<a class="code" href="classmessage.html#af9891cb7111375e6a36363afffb09d63">FatalError</a>(<span class="stringliteral">&quot;manure::GetWaterEvap - resistance to water vapour transport must be greater than zero&quot;</span>);
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 <span class="comment">//currently disabled</span>
<a name="l00287"></a>00287    <span class="keywordtype">double</span> result=0.0;
<a name="l00288"></a>00288    <span class="keywordflow">return</span> result;
<a name="l00289"></a>00289 }
<a name="l00290"></a>00290 
<a name="l00291"></a>00291 
<a name="l00292"></a>00292 <span class="comment">/****************************************************************************\</span>
<a name="l00293"></a>00293 <span class="comment">\****************************************************************************/</span>
<a name="l00294"></a><a class="code" href="classmanure.html#aefa4f7856537616586ae73e8a34cdf97">00294</a> <a class="code" href="classproduct.html">product</a>&amp; <a class="code" href="classmanure.html#aefa4f7856537616586ae73e8a34cdf97">manure::operator=</a>(<span class="keyword">const</span> <a class="code" href="classproduct.html">product</a>&amp; someManure)
<a name="l00295"></a>00295 {
<a name="l00296"></a>00296         <a class="code" href="classmanure.html">manure</a>* aManure;
<a name="l00297"></a>00297         aManure      = (<a class="code" href="classmanure.html">manure</a>*)(&amp;someManure);
<a name="l00298"></a>00298    <a class="code" href="classmanure.html#aefa4f7856537616586ae73e8a34cdf97">decomposable::operator=</a>(someManure);
<a name="l00299"></a>00299         Mg_content   = aManure-&gt;<a class="code" href="classmanure.html#a33d61ff2bca9b2344ca013d284176395">GetMg_content</a>();
<a name="l00300"></a>00300         Cu_content   = aManure-&gt;<a class="code" href="classmanure.html#af7b3d4f63546db980e899016faeeb500">GetCu_content</a>();
<a name="l00301"></a>00301         Rt_content   = aManure-&gt;<a class="code" href="classmanure.html#af02a1de2138e4c9e2aa182a2891e5182">GetRt_content</a>();
<a name="l00302"></a>00302         sand             = aManure-&gt;<a class="code" href="classmanure.html#aae99257f7fb59e92b218339362b9cb4b">Getsand</a>();
<a name="l00303"></a>00303 
<a name="l00304"></a>00304         pH           = aManure-&gt;<a class="code" href="classmanure.html#aeb6b9f64e829c8f799cd771c6090cdcf">GetpH</a>();
<a name="l00305"></a>00305    infiltFactor = aManure-&gt;<a class="code" href="classmanure.html#a9ef6ec705107f1162883332a05f5cd87">GetinfiltFactor</a>();
<a name="l00306"></a>00306    canopyStorageParameter = aManure-&gt;canopyStorageParameter;
<a name="l00307"></a>00307    maxDeg                = aManure-&gt;<a class="code" href="classmanure.html#aa608bf6f9be6d1d02c6788dfb8a6eadf">GetmaxDeg</a>();
<a name="l00308"></a>00308    degRateConst = aManure-&gt;<a class="code" href="classmanure.html#a17370a1b9fb3505d4dfd2d33430bd7e6">GetdegRateConst</a>();
<a name="l00309"></a>00309    degradableOM = aManure-&gt;<a class="code" href="classmanure.html#ade6dc43e945016f901ced6a54527ea80">GetdegradableOM</a>();;
<a name="l00310"></a>00310         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00311"></a>00311 }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313 <span class="comment">/****************************************************************************\</span>
<a name="l00314"></a>00314 <span class="comment">\****************************************************************************/</span>
<a name="l00315"></a><a class="code" href="classmanure.html#a021351fd3857778590b48842dfd8fd5f">00315</a> <a class="code" href="classproduct.html">product</a>&amp; <a class="code" href="classmanure.html#a021351fd3857778590b48842dfd8fd5f">manure::operator+</a>(<span class="keyword">const</span> <a class="code" href="classproduct.html">product</a>&amp; someManure)
<a name="l00316"></a>00316 {
<a name="l00317"></a>00317         <a class="code" href="classmanure.html">manure</a>* aManure;
<a name="l00318"></a>00318         aManure = (<a class="code" href="classmanure.html">manure</a>*)(&amp;someManure);
<a name="l00319"></a>00319         <span class="keywordtype">double</span> aAmount          = aManure-&gt;<a class="code" href="classproduct.html#a021ebef2da57e1d977cfe57e62c6e38b">GetAmount</a>();
<a name="l00320"></a>00320         <span class="keywordtype">double</span> aMg_content      = aManure-&gt;<a class="code" href="classmanure.html#a33d61ff2bca9b2344ca013d284176395">GetMg_content</a>();
<a name="l00321"></a>00321         <span class="keywordtype">double</span> aCu_content   = aManure-&gt;<a class="code" href="classmanure.html#af7b3d4f63546db980e899016faeeb500">GetCu_content</a>();
<a name="l00322"></a>00322         <span class="keywordtype">double</span> aRt_content   = aManure-&gt;<a class="code" href="classmanure.html#af02a1de2138e4c9e2aa182a2891e5182">GetRt_content</a>();
<a name="l00323"></a>00323         <span class="keywordtype">double</span> asand            = aManure-&gt;<a class="code" href="classmanure.html#aae99257f7fb59e92b218339362b9cb4b">Getsand</a>();
<a name="l00324"></a>00324 
<a name="l00325"></a>00325    <span class="keywordtype">double</span> apH           = aManure-&gt;<a class="code" href="classmanure.html#aeb6b9f64e829c8f799cd771c6090cdcf">GetpH</a>();
<a name="l00326"></a>00326    <span class="keywordtype">double</span> ainfiltFactor = aManure-&gt;<a class="code" href="classmanure.html#a9ef6ec705107f1162883332a05f5cd87">GetinfiltFactor</a>();
<a name="l00327"></a>00327    <span class="keywordtype">double</span> acanopyStorageParameter = aManure-&gt;<a class="code" href="classmanure.html#aa5a3178bfb7d4f5f87fe41d1d8221ed5">GetcanopyStorageParameter</a>();
<a name="l00328"></a>00328    <span class="keywordtype">double</span> amaxDeg       = aManure-&gt;<a class="code" href="classmanure.html#aa608bf6f9be6d1d02c6788dfb8a6eadf">GetmaxDeg</a>();
<a name="l00329"></a>00329    <span class="keywordtype">double</span> adegRateConst                         = aManure-&gt;<a class="code" href="classmanure.html#a17370a1b9fb3505d4dfd2d33430bd7e6">GetdegRateConst</a>();
<a name="l00330"></a>00330    <span class="keywordtype">double</span> adegradableOM = aManure-&gt;<a class="code" href="classmanure.html#ade6dc43e945016f901ced6a54527ea80">GetdegradableOM</a>();
<a name="l00331"></a>00331         <span class="keywordflow">if</span> ((apH&lt;1.0)||(apH&gt;12.0) || (pH&lt;1.0)||(pH&gt;12.0))
<a name="l00332"></a>00332                 <a class="code" href="message_8h.html#a8ad29009121a629982c6ade0bd332470">theMessage</a>-&gt;<a class="code" href="classmessage.html#af9891cb7111375e6a36363afffb09d63">FatalError</a>(<span class="stringliteral">&quot;pmanure: error in pH values in + routine&quot;</span>);
<a name="l00333"></a>00333         <span class="keywordflow">if</span>((<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>&gt;1E-6) &amp;&amp; (aAmount&gt;1E-6))
<a name="l00334"></a>00334         {
<a name="l00335"></a>00335            Mg_content     = (Mg_content*<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>   + aMg_content*aAmount)/(<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>+aAmount);
<a name="l00336"></a>00336            Cu_content     = (Cu_content*<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>   + aCu_content*aAmount)/(<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>+aAmount);
<a name="l00337"></a>00337            Rt_content     = (Rt_content*<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>   + aRt_content*aAmount)/(<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>+aAmount);
<a name="l00338"></a>00338       sand           = (sand*<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>         + asand*aAmount)/(<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>+aAmount);
<a name="l00339"></a>00339 
<a name="l00340"></a>00340       infiltFactor      = (infiltFactor*<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>         + ainfiltFactor*aAmount)/(<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>+aAmount);
<a name="l00341"></a>00341       canopyStorageParameter    = (canopyStorageParameter*<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>  + acanopyStorageParameter*aAmount)/(<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>+aAmount);
<a name="l00342"></a>00342       maxDeg         = (maxDeg*<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>         + amaxDeg*aAmount)/(<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>+aAmount);
<a name="l00343"></a>00343       degRateConst         = (degRateConst*<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>         + adegRateConst*aAmount)/(<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>+aAmount);
<a name="l00344"></a>00344 <span class="comment">//         double tmp     = ( pow(10.0,(-1.0)*pH)*amount + pow(10.0,(-1.0)*apH)*aAmount)/ (amount+aAmount);</span>
<a name="l00345"></a>00345 <span class="comment">//If used alone to calculate mean pH, the above line sometimes generates incorrect and very low numbers, which throw a maths exception</span>
<a name="l00346"></a>00346 <span class="comment">//Done as follows, it is ok - NJH</span>
<a name="l00347"></a>00347       <span class="keywordtype">double</span> tmp1 = pow(10.0,(-1.0)*pH)*<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>;
<a name="l00348"></a>00348       <span class="keywordtype">double</span> tmp2 = pow(10.0,(-1.0)*apH)*aAmount;
<a name="l00349"></a>00349       <span class="keywordtype">double</span> tmp =(tmp1 +tmp2)/(<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>+aAmount);
<a name="l00350"></a>00350            pH             = (-1.0)*(log10(tmp));
<a name="l00351"></a>00351         }
<a name="l00352"></a>00352    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (aAmount&gt;1E-6)
<a name="l00353"></a>00353    {
<a name="l00354"></a>00354         Mg_content     = aMg_content;
<a name="l00355"></a>00355            Cu_content     = aCu_content;
<a name="l00356"></a>00356            Rt_content     = aRt_content;
<a name="l00357"></a>00357       sand           = asand;
<a name="l00358"></a>00358            pH             = apH;
<a name="l00359"></a>00359       infiltFactor      = ainfiltFactor;
<a name="l00360"></a>00360       canopyStorageParameter = acanopyStorageParameter;
<a name="l00361"></a>00361       maxDeg         = amaxDeg;
<a name="l00362"></a>00362       degRateConst                              = adegRateConst;
<a name="l00363"></a>00363       degradableOM   = adegradableOM;
<a name="l00364"></a>00364    }
<a name="l00365"></a>00365         <a class="code" href="classmanure.html#a021351fd3857778590b48842dfd8fd5f">decomposable::operator+</a>(someManure);
<a name="l00366"></a>00366         <span class="keywordflow">if</span> ((<a class="code" href="classlive_matter.html#a8e7a9da472ef95f8426cab359acae69f" title="fraction N in NH4 of total amount">NH4_content</a>.<a class="code" href="classnitrogen.html#aa708078375ba23f1dd31e08e28269dac">n</a>&lt;0.0)||(<a class="code" href="classlive_matter.html#a7fd6353da8a485db5b95b1ccd78a5776" title="fraction N in orgN of total amount">orgN_content</a>.<a class="code" href="classnitrogen.html#aa708078375ba23f1dd31e08e28269dac">n</a>&lt;0.0))
<a name="l00367"></a>00367                 <a class="code" href="message_8h.html#a8ad29009121a629982c6ade0bd332470">theMessage</a>-&gt;<a class="code" href="classmessage.html#af9891cb7111375e6a36363afffb09d63">FatalError</a>(<span class="stringliteral">&quot;pmanure: error in N values in + routine&quot;</span>);
<a name="l00368"></a>00368         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00369"></a>00369 }
<a name="l00370"></a>00370 
<a name="l00371"></a>00371 <span class="comment">/****************************************************************************\</span>
<a name="l00372"></a>00372 <span class="comment">\****************************************************************************/</span>
<a name="l00373"></a><a class="code" href="classmanure.html#a78dc3bbc39591aeb4ac6b3b722d66a0d">00373</a> <a class="code" href="classproduct.html">product</a>&amp; <a class="code" href="classmanure.html#a78dc3bbc39591aeb4ac6b3b722d66a0d">manure::operator-</a>(<span class="keyword">const</span> <a class="code" href="classproduct.html">product</a>&amp; someManure)
<a name="l00374"></a>00374 {
<a name="l00375"></a>00375         <a class="code" href="classmanure.html">manure</a>* aManure;
<a name="l00376"></a>00376         aManure      = (<a class="code" href="classmanure.html">manure</a>*)(&amp;someManure);
<a name="l00377"></a>00377         <span class="keywordflow">if</span>(Mg_content   != aManure-&gt;<a class="code" href="classmanure.html#a33d61ff2bca9b2344ca013d284176395">GetMg_content</a>() ||
<a name="l00378"></a>00378                 Cu_content   != aManure-&gt;<a class="code" href="classmanure.html#af7b3d4f63546db980e899016faeeb500">GetCu_content</a>() ||
<a name="l00379"></a>00379                 Rt_content   != aManure-&gt;<a class="code" href="classmanure.html#af02a1de2138e4c9e2aa182a2891e5182">GetRt_content</a>() ||
<a name="l00380"></a>00380                 sand             != aManure-&gt;<a class="code" href="classmanure.html#aae99257f7fb59e92b218339362b9cb4b">Getsand</a>() ||
<a name="l00381"></a>00381 
<a name="l00382"></a>00382                 pH           != aManure-&gt;<a class="code" href="classmanure.html#aeb6b9f64e829c8f799cd771c6090cdcf">GetpH</a>() ||
<a name="l00383"></a>00383       infiltFactor != aManure-&gt;<a class="code" href="classmanure.html#a9ef6ec705107f1162883332a05f5cd87">GetinfiltFactor</a>() ||
<a name="l00384"></a>00384       degRateConst != aManure-&gt;<a class="code" href="classmanure.html#a17370a1b9fb3505d4dfd2d33430bd7e6">GetdegRateConst</a>() ||
<a name="l00385"></a>00385       maxDeg       != aManure-&gt;<a class="code" href="classmanure.html#aa608bf6f9be6d1d02c6788dfb8a6eadf">GetmaxDeg</a>() ||
<a name="l00386"></a>00386       degradableOM != aManure-&gt;<a class="code" href="classmanure.html#ade6dc43e945016f901ced6a54527ea80">GetdegradableOM</a>())
<a name="l00387"></a>00387          <a class="code" href="message_8h.html#a8ad29009121a629982c6ade0bd332470">theMessage</a>-&gt;<a class="code" href="classmessage.html#aacaa1466698a349689502491cf089f72">Warning</a>(<span class="stringliteral">&quot;manure::operator- - manure with different composition subtracted&quot;</span>);
<a name="l00388"></a>00388         <a class="code" href="classmanure.html#a78dc3bbc39591aeb4ac6b3b722d66a0d">decomposable::operator-</a>(someManure);
<a name="l00389"></a>00389         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00390"></a>00390 }
<a name="l00391"></a>00391 
<a name="l00392"></a>00392 <span class="comment">/****************************************************************************\</span>
<a name="l00393"></a>00393 <span class="comment">\****************************************************************************/</span>
<a name="l00394"></a><a class="code" href="classmanure.html#af2915d37963e5f4d3a4b0c0d91fab188">00394</a> <a class="code" href="classproduct.html">product</a>*  <a class="code" href="classmanure.html#af2915d37963e5f4d3a4b0c0d91fab188">manure::clone</a>()<span class="keyword"> const</span>
<a name="l00395"></a>00395 <span class="keyword"></span>{
<a name="l00396"></a>00396         <a class="code" href="classmanure.html">manure</a>* aProduct= <span class="keyword">new</span> <a class="code" href="classmanure.html#a169ecc5b27034bb777db79053f571c6e">manure</a>(*<span class="keyword">this</span>);
<a name="l00397"></a>00397         <span class="keywordflow">return</span> aProduct;
<a name="l00398"></a>00398 }
<a name="l00399"></a>00399 
<a name="l00400"></a>00400 <span class="comment">/****************************************************************************\</span>
<a name="l00401"></a>00401 <span class="comment">\****************************************************************************/</span>
<a name="l00402"></a><a class="code" href="classmanure.html#a2e7eacb3cc9ec517ace53b6edd1eee81">00402</a> <span class="keywordtype">void</span> <a class="code" href="classmanure.html#a2e7eacb3cc9ec517ace53b6edd1eee81">manure::ReadParameters</a>(fstream * file, <span class="keywordtype">bool</span> criticals,<span class="keyword">const</span> <span class="keywordtype">char</span> *  sectionName)
<a name="l00403"></a>00403 {
<a name="l00404"></a>00404         <a class="code" href="classmanure.html#a2e7eacb3cc9ec517ace53b6edd1eee81">decomposable::ReadParameters</a>(file,criticals, sectionName);
<a name="l00405"></a>00405    <a class="code" href="classbase.html#a3cb378050dc4ced8420f41dcd7292239">Setfile</a>(file);
<a name="l00406"></a>00406    <a class="code" href="classbase.html#a54337c5388451d2200bfc4129e10114d">critical</a>=criticals;
<a name="l00407"></a>00407    <span class="keywordflow">if</span>(<a class="code" href="classbase.html#a88e41ff60ffb7e707312a09f20457e73">FindSection</a>(sectionName,<a class="code" href="classbase.html#afa59aaa1a0201700640234eb13a03aae">Index</a>)==<span class="keyword">true</span>)
<a name="l00408"></a>00408         {
<a name="l00409"></a>00409    <a class="code" href="classbase.html#aff0b96b92d78c345fd60335cece99d08">GetParameter</a>(<span class="stringliteral">&quot;Mg_content&quot;</span>  ,&amp;Mg_content);
<a name="l00410"></a>00410         <a class="code" href="classbase.html#aff0b96b92d78c345fd60335cece99d08">GetParameter</a>(<span class="stringliteral">&quot;Cu_content&quot;</span>  ,&amp;Cu_content);
<a name="l00411"></a>00411         <a class="code" href="classbase.html#aff0b96b92d78c345fd60335cece99d08">GetParameter</a>(<span class="stringliteral">&quot;Rt_content&quot;</span>  ,&amp;Rt_content);
<a name="l00412"></a>00412         <a class="code" href="classbase.html#aff0b96b92d78c345fd60335cece99d08">GetParameter</a>(<span class="stringliteral">&quot;sand&quot;</span>        ,&amp;sand);
<a name="l00413"></a>00413         <a class="code" href="classbase.html#aff0b96b92d78c345fd60335cece99d08">GetParameter</a>(<span class="stringliteral">&quot;pH&quot;</span>          ,&amp;pH);
<a name="l00414"></a>00414         }
<a name="l00415"></a>00415    <a class="code" href="classbase.html#a3cb378050dc4ced8420f41dcd7292239">Setfile</a>(NULL);
<a name="l00416"></a>00416 }
<a name="l00417"></a>00417 
<a name="l00418"></a>00418 <span class="comment">/****************************************************************************\</span>
<a name="l00419"></a>00419 <span class="comment">Simple emission model - emission factor is proportion of TAN</span>
<a name="l00420"></a>00420 <span class="comment">Returns volatilised N in tonnes</span>
<a name="l00421"></a>00421 <span class="comment">\****************************************************************************/</span>
<a name="l00422"></a><a class="code" href="classmanure.html#ab9836c0cde19119bae96ee2602c75f95">00422</a> <span class="keywordtype">double</span> <a class="code" href="classmanure.html#ab9836c0cde19119bae96ee2602c75f95">manure::VolatNitrogen</a>(<span class="keywordtype">double</span> emissionFactor)
<a name="l00423"></a>00423 {
<a name="l00424"></a>00424   <span class="keywordtype">double</span> totalVolat = emissionFactor * <a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a> * <a class="code" href="classlive_matter.html#a8e7a9da472ef95f8426cab359acae69f" title="fraction N in NH4 of total amount">NH4_content</a>.<a class="code" href="classnitrogen.html#aa708078375ba23f1dd31e08e28269dac">n</a>;
<a name="l00425"></a>00425   <a class="code" href="classlive_matter.html#a8e7a9da472ef95f8426cab359acae69f" title="fraction N in NH4 of total amount">NH4_content</a>.<a class="code" href="classnitrogen.html#aa708078375ba23f1dd31e08e28269dac">n</a>*=(1-emissionFactor);
<a name="l00426"></a>00426   <span class="keywordflow">return</span> totalVolat;
<a name="l00427"></a>00427 }
<a name="l00433"></a><a class="code" href="classmanure.html#abf7e3e8410ff6ec04010568c204f9ca6">00433</a> <span class="keywordtype">void</span> <a class="code" href="classmanure.html#abf7e3e8410ff6ec04010568c204f9ca6">manure::VolatAndMinNitrogen</a>(<span class="keywordtype">double</span> NH3EF, <span class="keywordtype">double</span> N2EF, <span class="keywordtype">double</span> N2OEF, <span class="keywordtype">double</span> MinF,
<a name="l00434"></a>00434                         <span class="keywordtype">double</span> *NH3vol, <span class="keywordtype">double</span> *N2vol, <span class="keywordtype">double</span> *N2Ovol, <span class="keywordtype">double</span> *MinN)
<a name="l00435"></a>00435 {
<a name="l00436"></a>00436 <span class="comment">//      double scalingFactor=1.0;</span>
<a name="l00437"></a>00437   *NH3vol = NH3EF * <a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a> * <a class="code" href="classlive_matter.html#a8e7a9da472ef95f8426cab359acae69f" title="fraction N in NH4 of total amount">NH4_content</a>.<a class="code" href="classnitrogen.html#aa708078375ba23f1dd31e08e28269dac">n</a>;
<a name="l00438"></a>00438   *N2vol = N2EF * <a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a> * <a class="code" href="classlive_matter.html#a8e7a9da472ef95f8426cab359acae69f" title="fraction N in NH4 of total amount">NH4_content</a>.<a class="code" href="classnitrogen.html#aa708078375ba23f1dd31e08e28269dac">n</a>;
<a name="l00439"></a>00439   *N2Ovol = N2OEF * <a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a> * <a class="code" href="classlive_matter.html#a8e7a9da472ef95f8426cab359acae69f" title="fraction N in NH4 of total amount">NH4_content</a>.<a class="code" href="classnitrogen.html#aa708078375ba23f1dd31e08e28269dac">n</a>;
<a name="l00440"></a>00440   *MinN= MinF * <a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a> * <a class="code" href="classlive_matter.html#a7fd6353da8a485db5b95b1ccd78a5776" title="fraction N in orgN of total amount">orgN_content</a>.<a class="code" href="classnitrogen.html#aa708078375ba23f1dd31e08e28269dac">n</a>;
<a name="l00441"></a>00441   <a class="code" href="classlive_matter.html#a8e7a9da472ef95f8426cab359acae69f" title="fraction N in NH4 of total amount">NH4_content</a>.<a class="code" href="classnitrogen.html#aa708078375ba23f1dd31e08e28269dac">n</a>= <a class="code" href="classlive_matter.html#a8e7a9da472ef95f8426cab359acae69f" title="fraction N in NH4 of total amount">NH4_content</a>.<a class="code" href="classnitrogen.html#aa708078375ba23f1dd31e08e28269dac">n</a>*(1.0-(NH3EF+N2EF+N2OEF))+<a class="code" href="classlive_matter.html#a7fd6353da8a485db5b95b1ccd78a5776" title="fraction N in orgN of total amount">orgN_content</a>.<a class="code" href="classnitrogen.html#aa708078375ba23f1dd31e08e28269dac">n</a>*MinF;
<a name="l00442"></a>00442   <a class="code" href="classlive_matter.html#a7fd6353da8a485db5b95b1ccd78a5776" title="fraction N in orgN of total amount">orgN_content</a>.<a class="code" href="classnitrogen.html#aa708078375ba23f1dd31e08e28269dac">n</a>*=(1.0-MinF);
<a name="l00443"></a>00443 }
<a name="l00444"></a>00444 
<a name="l00445"></a>00445 
<a name="l00449"></a><a class="code" href="classmanure.html#a88f9fce0227f2bac1dfa448c1d149b9d">00449</a> <span class="keywordtype">double</span> <a class="code" href="classmanure.html#a88f9fce0227f2bac1dfa448c1d149b9d">manure::InstantaneousVolatAmmonia</a>(<span class="keywordtype">double</span> temperature, <span class="keywordtype">double</span> area, <span class="keywordtype">double</span> resistance, <span class="keywordtype">double</span> duration)
<a name="l00450"></a>00450 {  <span class="comment">//returns instantaneous volatilisation in tonnes of N</span>
<a name="l00451"></a>00451         <span class="comment">//temperature in K, infilt, precip and evap in (kg per sq metre per hr (mm/hr), area in sq metres and resistance in s per metre</span>
<a name="l00452"></a>00452    <span class="keywordtype">double</span> volat=0;
<a name="l00453"></a>00453 <span class="comment">/*</span>
<a name="l00454"></a>00454 <span class="comment">  Instantaneous flux (g/sq m/s) = (1/resistance) * Kh * 14 * [TAN]/(R*(temperature+273.15) * (1+pow(10,-pH)/KN))</span>
<a name="l00455"></a>00455 <span class="comment">  [TAN] =  NH4_content *amount * 1000/(14* amount *(1-dryMatter))   kg mol per litre</span>
<a name="l00456"></a>00456 <span class="comment">  assumes 1 litre=1 kg, molecular wt of N (14) cancels out</span>
<a name="l00457"></a>00457 <span class="comment">  Note - operates on hourly not per second basis; resistance input still in per second basis</span>
<a name="l00458"></a>00458 <span class="comment">*/</span>
<a name="l00459"></a>00459         <span class="keywordflow">if</span> (<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>&gt;0.0)
<a name="l00460"></a>00460    {
<a name="l00461"></a>00461         <span class="keywordflow">if</span> ((pH&lt;1.0)||(pH&gt;12.0))
<a name="l00462"></a>00462       <a class="code" href="message_8h.html#a8ad29009121a629982c6ade0bd332470">theMessage</a>-&gt;<a class="code" href="classmessage.html#af9891cb7111375e6a36363afffb09d63">FatalError</a>(<span class="stringliteral">&quot;pmanure: volatilisation error in pH values&quot;</span>);
<a name="l00463"></a>00463       <span class="keywordtype">double</span> TANPresent= <a class="code" href="classlive_matter.html#a8e7a9da472ef95f8426cab359acae69f" title="fraction N in NH4 of total amount">NH4_content</a>.<a class="code" href="classnitrogen.html#aa708078375ba23f1dd31e08e28269dac">n</a>*<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a> * 1000000.0/area;   <span class="comment">//in grams per sq metre</span>
<a name="l00464"></a>00464       <span class="keywordtype">double</span> volume = <a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a> * (1-<a class="code" href="classlive_matter.html#a1a622bc1c2258ae716f26c9dd3bf66d1">dryMatter</a>) * 1000.0/area;  <span class="comment">// litres/m**2</span>
<a name="l00465"></a>00465       <span class="keywordtype">double</span> KN=exp(-177.95292 - (1843.22/(temperature+273.15)) + 31.4335*log(temperature+273.15)
<a name="l00466"></a>00466                                 - 0.0544943*(temperature+273.15));  <span class="comment">//no units</span>
<a name="l00467"></a>00467       <span class="keywordtype">double</span> Kh=exp(160.559-(8621.06/(temperature+273.15))
<a name="l00468"></a>00468                                 - 25.6767*log(temperature+273.15)+0.035388*(temperature+273.15));  <span class="comment">// atm litre /mol</span>
<a name="l00469"></a>00469       <span class="keywordtype">double</span> R=0.0000820575;  <span class="comment">//universal gas constant in m**3 atm/(mol K)</span>
<a name="l00470"></a>00470       <span class="keywordtype">double</span> KH=14.0 * Kh/(R*(temperature+273.15));   <span class="comment">//g litre/(m**3 mol)</span>
<a name="l00471"></a>00471       <span class="keywordflow">if</span> (resistance==0)
<a name="l00472"></a>00472          <a class="code" href="message_8h.html#a8ad29009121a629982c6ade0bd332470">theMessage</a>-&gt;<a class="code" href="classmessage.html#af9891cb7111375e6a36363afffb09d63">FatalError</a>(<span class="stringliteral">&quot;manure:: The transfer resistance for ammonia loss cannot be zero&quot;</span>);
<a name="l00473"></a>00473       <span class="keywordtype">double</span> q = 3600.0 * KH/((1+pow(10,-pH)/KN)*resistance * volume * 14.0); <span class="comment">//rate constant, per hour</span>
<a name="l00474"></a>00474       volat = q * duration * TANPresent;
<a name="l00475"></a>00475       <span class="keywordflow">if</span> (volat &gt; TANPresent)
<a name="l00476"></a>00476       {
<a name="l00477"></a>00477               <a class="code" href="classlive_matter.html#ae1c5d6b2f85882a85817e26a8fc9391f">SetNH4_content</a>(0.0);
<a name="l00478"></a>00478         volat = TANPresent * area/1000000.0;
<a name="l00479"></a>00479       }
<a name="l00480"></a>00480       <span class="keywordflow">else</span>
<a name="l00481"></a>00481       {
<a name="l00482"></a>00482          volat *= area/1000000.0;       <span class="comment">//convert from grams per sq metre to tonnes</span>
<a name="l00483"></a>00483          <span class="keywordtype">double</span> newNH4_content = (<a class="code" href="classlive_matter.html#a8e7a9da472ef95f8426cab359acae69f" title="fraction N in NH4 of total amount">NH4_content</a>.<a class="code" href="classnitrogen.html#aa708078375ba23f1dd31e08e28269dac">n</a>*<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>-volat)/<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>;
<a name="l00484"></a>00484          TANPresent *= area/1000000.0;       <span class="comment">//convert from grams per sq metre to tonnes</span>
<a name="l00485"></a>00485          <span class="keywordtype">double</span> balance =  TANPresent -(newNH4_content*<a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a> + volat);
<a name="l00486"></a>00486          <span class="keywordflow">if</span> (fabs(balance)&gt;0.0001)
<a name="l00487"></a>00487             <a class="code" href="message_8h.html#a8ad29009121a629982c6ade0bd332470">theMessage</a>-&gt;<a class="code" href="classmessage.html#af9891cb7111375e6a36363afffb09d63">FatalError</a>(<span class="stringliteral">&quot;manure:: Balance error in volatilisation&quot;</span>);
<a name="l00488"></a>00488          <a class="code" href="classlive_matter.html#ae1c5d6b2f85882a85817e26a8fc9391f">SetNH4_content</a>(newNH4_content);
<a name="l00489"></a>00489       }
<a name="l00490"></a>00490     }
<a name="l00491"></a>00491  <span class="keywordflow">return</span> volat;
<a name="l00492"></a>00492  <span class="comment">//volatilisation in tonnes.</span>
<a name="l00493"></a>00493 }
<a name="l00497"></a><a class="code" href="classmanure.html#a9005bcd6e277a3f993b1c67b90edfb35">00497</a> <span class="keywordtype">double</span> <a class="code" href="classmanure.html#a9005bcd6e277a3f993b1c67b90edfb35">manure::doDenitrification</a>(<span class="keywordtype">double</span> temperature, <span class="keywordtype">double</span> duration, <span class="keywordtype">double</span> *N2, <span class="keywordtype">double</span> *N2O)
<a name="l00498"></a>00498 {  <span class="comment">//N2 and N2O emission in kg, placeholder for better funtion</span>
<a name="l00499"></a>00499         <span class="keywordflow">if</span> (temperature&lt;=0.0)
<a name="l00500"></a>00500         *N2=0.0;
<a name="l00501"></a>00501    <span class="keywordflow">else</span>
<a name="l00502"></a>00502            *N2 = 0.00001 * duration * <a class="code" href="classmanure.html#a1a9772a5fe0cdc749b004b175abcfa3c">mesoTemperatureFunc</a>(temperature) * <a class="code" href="classmanure.html#a3e7121336d2d986fcd06766902ebc1e4">MoistureFunc</a>() * <a class="code" href="classlive_matter.html#a461f95ec9e31447ffee31066ea357ab1">GetNH4_content</a>().<a class="code" href="classnitrogen.html#aa708078375ba23f1dd31e08e28269dac">n</a> * <a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>;
<a name="l00503"></a>00503    *N2O = *N2/9.0;
<a name="l00504"></a>00504     <span class="keywordtype">double</span> N = <a class="code" href="classlive_matter.html#a8e7a9da472ef95f8426cab359acae69f" title="fraction N in NH4 of total amount">NH4_content</a>.<a class="code" href="classnitrogen.html#aa708078375ba23f1dd31e08e28269dac">n</a> * <a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>;
<a name="l00505"></a>00505     N-= (*N2 + *N2O);
<a name="l00506"></a>00506     <a class="code" href="classlive_matter.html#ae1c5d6b2f85882a85817e26a8fc9391f">SetNH4_content</a>(N/<a class="code" href="classproduct.html#a021ebef2da57e1d977cfe57e62c6e38b">GetAmount</a>());
<a name="l00507"></a>00507    <span class="keywordflow">return</span> (*N2 + *N2O);
<a name="l00508"></a>00508 }
<a name="l00512"></a><a class="code" href="classmanure.html#a6ecbd94610934e7ee281c62ea8d2fcde">00512</a> <span class="keywordtype">double</span> <a class="code" href="classmanure.html#a6ecbd94610934e7ee281c62ea8d2fcde">manure::GetMethaneEmission</a>(<span class="keywordtype">double</span> temperature, <span class="keywordtype">double</span> duration)
<a name="l00513"></a>00513 {  <span class="comment">//returns CH4-C emission in kg, placeholder for better funtion</span>
<a name="l00514"></a>00514         <span class="keywordtype">double</span> ret_val;
<a name="l00515"></a>00515         <span class="keywordflow">if</span> ((temperature-273.15)&lt;=0.0)
<a name="l00516"></a>00516         ret_val=0.0;
<a name="l00517"></a>00517    <span class="keywordflow">else</span>
<a name="l00518"></a>00518            ret_val= 0.00001 * duration * temperature * <a class="code" href="classmanure.html#ad293bc0666ccc034fe1f15a1df2a4010">GetOrgMatterConc</a>() * <a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>;
<a name="l00519"></a>00519    <span class="keywordflow">return</span> ret_val;
<a name="l00520"></a>00520 }
<a name="l00524"></a><a class="code" href="classmanure.html#ac9206359d7b5dcdcf7c1dba31f490342">00524</a> <span class="keywordtype">double</span> <a class="code" href="classmanure.html#ac9206359d7b5dcdcf7c1dba31f490342">manure::GetCarbonDioxideEmission</a>(<span class="keywordtype">double</span> temperature, <span class="keywordtype">double</span> duration)
<a name="l00525"></a>00525 {  <span class="comment">//returns CO2-C  emission in kg, placeholder for better funtion</span>
<a name="l00526"></a>00526         <span class="keywordtype">double</span> ret_val;
<a name="l00527"></a>00527         <span class="keywordflow">if</span> (temperature&lt;=0.0)
<a name="l00528"></a>00528         ret_val=0.0;
<a name="l00529"></a>00529    <span class="keywordflow">else</span>
<a name="l00530"></a>00530            ret_val=0.0001 * duration * temperature * <a class="code" href="classmanure.html#ad293bc0666ccc034fe1f15a1df2a4010">GetOrgMatterConc</a>() * <a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>;
<a name="l00531"></a>00531    <span class="keywordflow">return</span> ret_val;
<a name="l00532"></a>00532 }
<a name="l00533"></a>00533 
<a name="l00537"></a><a class="code" href="classmanure.html#a8262006c9db5b1e7fcdb0b73e8f23260">00537</a> <span class="keywordtype">void</span> <a class="code" href="classmanure.html#a8262006c9db5b1e7fcdb0b73e8f23260">manure::CalcOMdegradation</a>(<span class="keywordtype">double</span> temperature, <span class="keywordtype">double</span> duration, <span class="keywordtype">double</span> degRateConst, <span class="keywordtype">double</span> *CO2, <span class="keywordtype">double</span> *CH4, <span class="keywordtype">double</span> *NH4)
<a name="l00538"></a>00538 {
<a name="l00539"></a>00539         <span class="keywordtype">double</span> currentOM = <a class="code" href="classmanure.html#ad293bc0666ccc034fe1f15a1df2a4010">GetOrgMatterConc</a>()* <a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>;
<a name="l00540"></a>00540    <span class="keywordtype">double</span> OMdeg=degRateConst * duration * <a class="code" href="classmanure.html#a1a9772a5fe0cdc749b004b175abcfa3c">mesoTemperatureFunc</a>(temperature) * <a class="code" href="classmanure.html#a3e7121336d2d986fcd06766902ebc1e4">MoistureFunc</a>() * currentOM ;<span class="comment">//* maxDeg;</span>
<a name="l00541"></a>00541    <span class="keywordtype">double</span> C = <a class="code" href="classlive_matter.html#abe13a37fe5a11f5fcb286b4031c4fc87" title="fraction C of total amount">C_content</a> * <a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>;
<a name="l00542"></a>00542    <span class="keywordtype">double</span> Cdeg = (OMdeg/currentOM) * C;
<a name="l00543"></a>00543    *CH4 = 0.75 * Cdeg;
<a name="l00544"></a>00544    *CO2 = Cdeg - *CH4;
<a name="l00545"></a>00545    C-= (*CO2 + *CH4);
<a name="l00546"></a>00546    <a class="code" href="classlive_matter.html#ac85d49a99a56f9f3e47822ebaf54cbaf">SetC_content</a>(C/<a class="code" href="classproduct.html#a021ebef2da57e1d977cfe57e62c6e38b">GetAmount</a>());
<a name="l00547"></a>00547    <span class="keywordtype">double</span> OrgN = <a class="code" href="classlive_matter.html#a7fd6353da8a485db5b95b1ccd78a5776" title="fraction N in orgN of total amount">orgN_content</a>.<a class="code" href="classnitrogen.html#aa708078375ba23f1dd31e08e28269dac">n</a> * <a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a>;
<a name="l00548"></a>00548    <span class="keywordtype">double</span> OrgNdeg =(OMdeg/currentOM) * OrgN;
<a name="l00549"></a>00549    *NH4= OrgNdeg;
<a name="l00550"></a>00550    <a class="code" href="classlive_matter.html#a8e7a9da472ef95f8426cab359acae69f" title="fraction N in NH4 of total amount">NH4_content</a>=(amount * <a class="code" href="classlive_matter.html#a8e7a9da472ef95f8426cab359acae69f" title="fraction N in NH4 of total amount">NH4_content</a>.<a class="code" href="classnitrogen.html#aa708078375ba23f1dd31e08e28269dac">n</a> + *NH4)/amount;
<a name="l00551"></a>00551    OrgN-=OrgNdeg;
<a name="l00552"></a>00552    <a class="code" href="classlive_matter.html#adbb45be219dd863cfad2b5e97cde1508">SetorgN_content</a>(OrgN/<a class="code" href="classproduct.html#a021ebef2da57e1d977cfe57e62c6e38b">GetAmount</a>());
<a name="l00553"></a>00553    <a class="code" href="classmanure.html#a8c330c3c3c05dc44b7c75eae581b717c">CalcDryMatterConc</a>();
<a name="l00554"></a>00554 }
<a name="l00555"></a>00555 
<a name="l00556"></a>00556 
<a name="l00560"></a><a class="code" href="classmanure.html#a8c330c3c3c05dc44b7c75eae581b717c">00560</a> <span class="keywordtype">double</span> <a class="code" href="classmanure.html#a8c330c3c3c05dc44b7c75eae581b717c">manure::CalcDryMatterConc</a>()
<a name="l00561"></a>00561 {
<a name="l00562"></a>00562         <a class="code" href="classlive_matter.html#a1a622bc1c2258ae716f26c9dd3bf66d1">dryMatter</a> = 2.5 * <a class="code" href="classlive_matter.html#abe13a37fe5a11f5fcb286b4031c4fc87" title="fraction C of total amount">C_content</a>+sand;
<a name="l00563"></a>00563         <span class="keywordflow">return</span> <a class="code" href="classlive_matter.html#a1a622bc1c2258ae716f26c9dd3bf66d1">dryMatter</a>;
<a name="l00564"></a>00564 };
<a name="l00568"></a><a class="code" href="classmanure.html#ae63202774deb8721397a915d15679dba">00568</a> <span class="keywordtype">double</span> <a class="code" href="classmanure.html#ae63202774deb8721397a915d15679dba">manure::VolatCarbon</a>(<span class="keywordtype">double</span> emissionFactor)
<a name="l00569"></a>00569 {
<a name="l00570"></a>00570   <span class="keywordtype">double</span> totalVolat = emissionFactor * <a class="code" href="classproduct.html#aa3df4db37dfee2a7585a75456c3c361e">amount</a> * <a class="code" href="classlive_matter.html#abe13a37fe5a11f5fcb286b4031c4fc87" title="fraction C of total amount">C_content</a>;
<a name="l00571"></a>00571   C_content*=(1-emissionFactor);
<a name="l00572"></a>00572   <span class="keywordflow">return</span> totalVolat;
<a name="l00573"></a>00573 }
<a name="l00574"></a>00574 
<a name="l00580"></a><a class="code" href="classmanure.html#a1a9772a5fe0cdc749b004b175abcfa3c">00580</a> <span class="keywordtype">double</span> <a class="code" href="classmanure.html#a1a9772a5fe0cdc749b004b175abcfa3c">manure::mesoTemperatureFunc</a>(<span class="keywordtype">double</span> temperature)
<a name="l00581"></a>00581 {
<a name="l00582"></a>00582         <span class="keywordtype">double</span> ret_val=0.0;
<a name="l00583"></a>00583    <span class="comment">//all these limits are guesses....</span>
<a name="l00584"></a>00584    <span class="keywordtype">double</span> t1 = 0.0;
<a name="l00585"></a>00585    <span class="keywordtype">double</span> t2 = 20.0;
<a name="l00586"></a>00586    <span class="keywordtype">double</span> t3 = 30.0;
<a name="l00587"></a>00587    <span class="keywordtype">double</span> t4 = 40.0;
<a name="l00588"></a>00588    <span class="keywordflow">if</span> ((temperature&lt;t1) || (temperature&gt;t4))
<a name="l00589"></a>00589         ret_val= 0.0;
<a name="l00590"></a>00590    <span class="keywordflow">else</span>
<a name="l00591"></a>00591            <span class="keywordflow">if</span> ((temperature&gt;t2) &amp;&amp; (temperature&lt;t3))
<a name="l00592"></a>00592                 ret_val= 1.0;
<a name="l00593"></a>00593       <span class="keywordflow">else</span>
<a name="l00594"></a>00594                    <span class="keywordflow">if</span> ((temperature&gt;t1) &amp;&amp; (temperature&lt;t2))
<a name="l00595"></a>00595                         ret_val= (temperature-t1)/(t2-t1);
<a name="l00596"></a>00596                    <span class="keywordflow">else</span>
<a name="l00597"></a>00597                         ret_val= (t4-temperature)/(t4-t3);
<a name="l00598"></a>00598         <span class="keywordflow">return</span> ret_val;
<a name="l00599"></a>00599 }
<a name="l00603"></a><a class="code" href="classmanure.html#a3e7121336d2d986fcd06766902ebc1e4">00603</a> <span class="keywordtype">double</span> <a class="code" href="classmanure.html#a3e7121336d2d986fcd06766902ebc1e4">manure::MoistureFunc</a>()
<a name="l00604"></a>00604 {
<a name="l00605"></a>00605         <span class="keywordtype">double</span> ret_val=0.0;
<a name="l00606"></a>00606    <span class="comment">//all these limits are guesses....</span>
<a name="l00607"></a>00607    <span class="keywordtype">double</span> w1 = 0.0;  <span class="comment">//water content as %</span>
<a name="l00608"></a>00608    <span class="keywordtype">double</span> w2 = 20.0;
<a name="l00609"></a>00609    <span class="keywordtype">double</span> w3 = 30.0;
<a name="l00610"></a>00610    <span class="keywordtype">double</span> w4 = 100.0;
<a name="l00611"></a>00611    <span class="keywordtype">double</span> waterContent = 100.0 * (1-<a class="code" href="classlive_matter.html#a1a622bc1c2258ae716f26c9dd3bf66d1">dryMatter</a>);
<a name="l00612"></a>00612    <span class="keywordflow">if</span> ((waterContent&lt;w1) || (waterContent&gt;w4))
<a name="l00613"></a>00613            ret_val= 0.0;
<a name="l00614"></a>00614    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((waterContent&gt;w2) &amp;&amp; (waterContent&lt;w3))
<a name="l00615"></a>00615                 ret_val= 1.0;
<a name="l00616"></a>00616    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((waterContent&gt;w1) &amp;&amp; (waterContent&lt;w2))
<a name="l00617"></a>00617            ret_val= (waterContent-w1)/(w2-w1);
<a name="l00618"></a>00618         <span class="keywordflow">else</span>
<a name="l00619"></a>00619                         ret_val= (w4 - waterContent)/(w4-w3);
<a name="l00620"></a>00620         <span class="keywordflow">return</span> ret_val;
<a name="l00621"></a>00621 }
<a name="l00622"></a>00622 
</pre></div></div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Mon Aug 22 2011 10:29:04 for Fasset by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
